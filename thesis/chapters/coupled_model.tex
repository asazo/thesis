\chapter{The Coupled Model}
\label{chap:coupledmodel}

\lettrine{N}{umerical} simulations studied by vertex-driven motion and curvature-driven motion as exposed in Chapter \ref{chap:2dgrains} can be also studied in a coupled way with the purpose of capturing the dynamics of both models and being able to reproduce each one of them individually. This novel model is called Coupled Model and has been developed in a first version in \cite{bachelorthesisasazo} and improved during the study of the present work. The boundary parametrization proposed here consist in a Lagrange interpolation of $n$ points as follows:
\begin{equation}
    \vxi(s,t) = \boundary,\quad s \in [0,1],
    \label{eq:boundarydiscret}
\end{equation}
where $\phi_i(s)$ are the Lagrange interpolation functions and the points $\x[1]^{(k)}$ and $\x[n]^{(k)}$ are triple junctions. The remaining $n-2$ collocation points are called interior points. For numerical stability each point $\x[i]^{(k)}$ is parametrized on Chebyshev nodes of the second kind\cite{trefethen2000spectral} with a linear transformation to stay in the domain $[0,1]$.

We start with the derivative of the total energy of the grain structure in \eqref{eq:dEdtfull} and we replace the proposed parametrization as:
\begin{equation}
    \frac{dE}{dt}(t) = \int_0^1 -\sum_{k=1}^{K}\left[ \sum_{i=1}^{n} \dotx[i][k](t)  \cdot \int_0^1  \gamma^{(k)}\dTds^{(k)}\!\! \phi_i(s)\,ds \right] + \sum_{m=1}^{M} \vel_m(t) \cdot \sum_{l=1}^3 \gamma^{(m,l)}\T^{(m,l)}.
    \label{eq:dEdtcoupled1}
\end{equation}
In order to find the motion equations of the system we separate the terms related to triple junctions from the summatory over grain boundaries in \eqref{eq:dEdtcoupled1} as:
\begin{multline*}
    \frac{dE}{dt}(t) =  -\sum_{k=1}^{K}\left[ \sum_{i=2}^{n-1} \dotx[i][k](t)  \cdot \int_0^1  \gamma^{(k)}\dTds^{(k)}\!\! \phi_i(s)\,ds \right] + \sum_{m=1}^{M} \vel_m(t) \cdot \sum_{l=1}^3 \gamma^{(m,l)}\T^{(m,l)} + \\ \sum_{k=1}^K \left[\dotx[1][k](t)\cdot\int_0^1 \gamma^{(k)} \dTds^{(k)}\!\! \phi_1(s)\,ds + \dotx[n][k](t)\cdot\int_0^1 \gamma^{(k)} \dTds^{(k)}\!\! \phi_n(s)\,ds\right].
\end{multline*}
Then we add them up to the former triple junction term. Notice that we must choose which contribution (from $\x[1][k]$ or $\x[n][k]$) will be added, since for some arbitrary pair of boundaries $k_1, k_2$, $\x[1][k_1] = \x[n][k_2]$ and we would be adding repeated terms. Re-indexing this contribution in terms of the triple junctions we obtain:
\begin{multline}
    \frac{dE}{dt}(t) =   -\sum_{k=1}^{K}\left[ \sum_{i=2}^{n-1} \dotx[i][k](t)  \cdot \int_0^1  \gamma^{(k)}\dTds^{(k)}\!\! \phi_i(s)\,ds \right] + \sum_{m=1}^{M} \vel_m(t) \cdot \sum_{l=1}^3 \gamma^{(m,l)}\T^{(m,l)} - \\ \sum_{m=1}^{M} \dotx[m]\,\,(t) \cdot \sum_{l=1}^3 \int_0^1 \gamma^{(m,l)} \dTds^{(m,l)}\phi_{1,m}(s)\,ds.
    \label{eq:dEdtcoupled3}
\end{multline}
where $\vel_m = \dotx[m]$. From Chapter \ref{chap:closedboundary}, we can obtain curvature driven motion if we add in the curvature term $1/\norm{\mylvec(s,t)}$ from \eqref{eq:coupledvelocity} to the velocity of the interior points. Thus, the motion equations of the improved model are:
\begin{align}
    \dotx[i][k](t) &= \frac{\mu\gamma^{(k)}}{\norm{\mylvec(s_i,t)}} \int_0^1 \dTds^{(k)}\!\!\phi_i(s)\,ds \\
    \dotx[m]\,\,(t) &= -\lambda\sum_{l=1}^{3}\gamma^{(m,l)} \left[\T^{(m,l)} - \int_0^1 \dTds^{(m,l)}\,\phi_{1,m}(s)\,ds \right],
\end{align}
where $\lambda$ and $\mu$ are the mobilities for interior points, inherited from boundary motion, and lambda is the triple junction mobility.
\section{Numerical Implementation}

An important result of the study of extinction time is that topological transitions are delayed because the extinction time estimation has an error proportional to the simulation $\Delta t$. This study suggest that the continuous motion of triple junctions and boundaries must be accurate enough to estimate extinction times of higher order. 

The first idea to obtain a better approximation of extinction time is to perform $r$ steps of size $\Delta \tau$ such that $\Delta \tau = \Delta t / r$. During the execution of this steps, the basic assumption is that no topological transition occurs and thus the system just evolves. Using a smaller time step helps to ensure a better approximation. On the other hand, straightforward higher order methods can be used. For example second order Runge-Kutta ensures that the grain system evolves with precision $\mathcal{O}(\Delta t^2)$, and therefore the extinction time has the same precision. Runge-Kutta can also be improved by the introduction of many steps of smaller size. 
In both methods, topological transitions that might occur in $[t, t+\Delta t]$ are detected and managed after the evolution is performed. Both methods are discussed below.

\subsection{Multistep Euler}

This method assumes that Euler method can be improved if steps of smaller size are performed to evolve the grain structure previous to handle topological transitions. A number $r$ of smaller steps of size $\Delta \tau$ is chosen, where $\Delta \tau = \Delta t / r$. The execution of this $r$ steps is called the \emph{multistep stage} and the system evolves assuming that there are not topological transitions. Algorithm \ref{alg:multistep} shows this method.

\begin{algorithm}
\caption{Multistep Euler for Coupled Model}
\label{alg:multistep}
\begin{algorithmic}[1]
\Procedure{ME}{}
\State $\Delta \tau \gets \dfrac{\Delta t}{r}$ Time step of multistep phase.
\For{$k:1,\dotso,r$}
%\State Detect Topological Transitions
\State $\mathbf{V}_t \gets$ Compute velocities
\State $X_{t + \Delta \tau} \gets X_{t} + \Delta \tau \mathbf{V}_t$
\State $t \gets t + \Delta \tau$
\EndFor
\EndProcedure
\end{algorithmic}
\end{algorithm}

Using a smaller step-size helps to ensure a better approximation of the extinction time proportional to $\mathcal{O}(\Delta \tau)$.
Inside the multistep stage, topological transitions are detected by computing the extinction time of the boundaries and comparing it with $\Delta t$ but they are not performed. When the multistep stage is over all the topological transitions found are filtered so there are no inconsistencies and then are performed safely. No extra memory is required for this method, but the cost if purely computational since the method is performing $r$ steps per main step and thus is almost $r$ times slower.  Notice that when $r = 1$, we recover the original Forward Euler method.

\subsection{Multistep Second Order Runge-Kutta}

If the goal is to obtain a good approximation of the extinction time, a higher order method can be implemented straightforward. For example extinction times with precision $\mathcal{O}(\Delta t^2)$ can be estimated using second order Runge-Kutta (RK2). We can also improve this method by means of introducing the multistep idea to perform several RK2 steps within $[t,t+\Delta t]$ as shown in Algorithm \ref{alg:rk2}.

\begin{algorithm}
\caption{Multistep Second Order Runge-Kutta for Coupled Model}
\label{alg:rk2}
\begin{algorithmic}[1]
\Procedure{MRK2}{}
\State $\Delta \tau \gets \dfrac{\Delta t}{r}$ Time step of multistep phase.
\For{$k:1,\dotso,r$}
\State $\mathbf{\overline{X}}_t \gets$ Backup positions $\mathbf{X}_t$ of triple junctions and interior points
\State $\mathbf{V}_t \gets$ Compute velocities
\State $\mathbf{X}_{t + \Delta \tau / 2} \gets \mathbf{X}_t + \dfrac{\Delta \tau}{2} \mathbf{V}_t$. Evolve structure for first RK estimation
\State $\mathbf{V}_{t + \Delta \tau /2} \gets$ Compute velocities
\State $\mathbf{X}_{t + \Delta \tau} \gets \mathbf{\overline{X}}_t + \Delta \tau \mathbf{V}_{t + \Delta \tau /2}$ . Evolve structure for second RK estimation
\State $t \gets t + \Delta \tau$
\EndFor
\EndProcedure
\end{algorithmic}
\end{algorithm}

The cost of this method lies in the memory needed to store the extra data for performing the two estimations at time $\Delta \tau/2$ and $\Delta \tau$ and the number of steps $r$. Notice that when $r = 1$  we recover the original RK2. In this implementation it is only necessary to backup the positions of the vertices and interior points to be used in the last step of the method and not the whole data structure \ie arc lengths, curvatures, grain areas, etc.

\subsection{Convergence Analysis of Extinction Time Estimation}